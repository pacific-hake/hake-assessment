\newpage

\rfoot{SRG requests}

# SRG requests {#sec:app-srg-requests}

## Day 1

### Request 1:

**SRG request**:
Summarize the number of aged fish by month for each sector in the US and Canada (if possible). Compare these to the monthly catch plots.

**Justification:**
This will help to determine if the age data are representative of the fishery catches. If the number of ages are consistent with the catch, then the ages are likely to be representative.

(ref:srg-catch-by-month-cap) Catch by month in `r last_data_yr` for all sectors of the U.S. and fleets of Canada.

(ref:srg-catch-by-month-alt) The figure shows that 

```{r srg-catch-by-month-fig, fig.cap = "(ref:srg-catch-by-month-cap)", fig.height = 5, fig.asp = 0.8, out.height = "6in"}

plot_catch_by_month(list(us_ss_catch_by_month_df,
                         can_ss_catch_by_month_df,
                         us_cp_catch_by_month_df,
                         can_ft_catch_by_month_df,
                         us_ms_catch_by_month_df),
                    list("U.S. Shoreside",
                         "Canadian Shoreside",
                         "U.S. Catcher-Processor",
                         "Canadian Freezer-Trawlers",
                         "U.S. Mothership"),
                    type = "catch",
                    disclaimer_text = paste0(
                      "These plots have different y-axis ranges\n",
                      "and are not directly comparable\n",
                      "with each other."),
                    yrs = c(2025, 2025),
                    leg_font_size = 8,
                    title_font_size = 10,
                    ax_text_x = 8,
                    ax_text_y = 8)
```

#### Request 1 Results: Sector/Fleet-based Samples by Month

```{r srg-age-comp-comparison, results = "asis"}

sample_df <- canada_load_sample_data() |> 
  dplyr::filter(sex %in% c(1, 2))

samples_fleet_lst <- canada_get_fleet_samples(sample_df)
# Remove JV for this table
samples_fleet_lst <- samples_fleet_lst[names(samples_fleet_lst) != "jv"]

samples_summary_tbls_lst <- canada_extract_sampling_by_month(
  samples_fleet_lst,
  yr = last_data_yr)
```

**Canadian Fleets**
```{r srg-canada-sample-summary-ft-tab, results = "asis"}

cap <- paste0("Canadian sampling by month for ", last_data_yr, " in the Freezer trawler sector.")
table_sampling_by_month(samples_summary_tbls_lst$ft,
                        font_size = 8,
                        header_font_size = 9,
                        caption = cap)
```

```{r srg-canada-sample-summary-ss-tab, results = "asis"}

cap <- paste0("Canadian sampling by month for ", last_data_yr, " in the Shoreside sector.")
table_sampling_by_month(samples_summary_tbls_lst$ss,
                        font_size = 8,
                        header_font_size = 9,
                        caption = cap)
```

**U.S. Sectors**

```{r srg-us-atsea-cp-sampling-summary-tab, results = "asis"}

d<- tibble(month = c("May", "Jun", "Jul", "Aug", "Sep", "Oct", "Total"),
           num_age = c(250, 135, 0, 0, 0, 170, 555),
           num_length = c(507, 269, 0, 0, 0, 541, 1317),
           num_weight = c(507, 269, 0, 0, 0, 541, 1317))

cap <- paste0("U.S. sampling by month for ", last_data_yr, " in the catcher-processor at-sea sector.")
table_sampling_by_month(d,
                        font_size = 8,
                        header_font_size = 9,
                        caption = cap)
```

```{r srg-us-at-sea-ms-sampling-summary-tab, results = "asis"}

d <- tibble(month = c("May", "Jun", "Jul", "Aug", "Sep", "Oct", "Total"),
            num_age = c(0, 134, 164, 177, 150, 38, 663),
            num_length = c(0, 266, 311, 319, 276, 64, 1236),
            num_weight = c(0, 266, 311, 319, 276, 64, 1236))

cap <- paste0("U.S. sampling by month for ", last_data_yr, " in the mothership at-sea sector.")
table_sampling_by_month(d,
                        font_size = 8,
                        header_font_size = 9,
                        caption = cap)
```


```{r srg-us-sb-sampling-summary-tab, results = "asis"}

d <- tibble(month = c("April", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Total"),
            num_age = c(2, 118, 229, 450, 370, 290, 170, 0, 1629),
            num_length = c(6, 78, 360, 440, 440, 340, 388, 20, 2066),
            num_weight = c(6, 78, 360, 440, 440, 340, 388, 20, 2066))

cap <- paste0("U.S. sampling by month for ", last_data_yr, " in the shore-based sector.")
table_sampling_by_month(d,
                        font_size = 8,
                        header_font_size = 9,
                        caption = cap)
```

### Request 2

**SRG request:**
Show the expected fishery age proportions for 2025 and 2026 fishery (this is fig 43 in 2025 assessment and slide 10 of management outcomes presentation). Possibly overlay this with 2025 fishery observations to compare the two. The JTC can decide how to present the observed 2025 fishery data.

**Justification:**
This request will identify the correct predictions of fishery proportions-at-age for 2025 and 2026, thus providing insights into what the model expects  for 2025 fisheries proportions-at-age. Comparing to the observations from 2025 will help to identify potential biases in the assessment, in particular related to the assumption of fixing recent recruitment to less than average recruitment.

#### Request 2 results: 

```{r srg-fore-age-props-tab, results = "asis"}

cap <- paste0("Vulnerable projected age compositions for ", assess_yr, ".")
table_fore_age_props(fore_catch_prop,
                     fore_catch_prop_wt,
                     ages_filt = 1:15,
                     font_size = 8,
                     caption = cap)
```

(ref:srg-main-age-comp-forecast-cap) Vulnerable projected age compositions for `r assess_yr`. The left panel shows the proportions by number; the right panel shows the proportions by weight. Selectivity for `r assess_yr` was not available in the model output so `r last_data_yr` was used instead.

(ref:srg-main-age-comp-forecast-alt) This figure shows that age 5 and 6 fish will be dominant in the stock in `r assess_yr`

```{r srg-age-comp-forecast-fig, fig.cap = "(ref:srg-main-age-comp-forecast-cap)", fig.height = 4, fig.asp = 0.8, out.height = "4in"}

plot_fore_age_comps(base_model,
                    y_lim = c(0, 0.7),
                    is_catch_proj = TRUE)
```

(ref:srg-age-comp-forecast-comparison-cap) Proportions of `r last_data_yr` catch-at-age, expected proportions of catch-at-age from the `r last_data_yr` assessment model, and expected proportions of catch-at-age from the `r assess_yr` assessment model.

(ref:srg-age-comp-forecast-comparison-alt) This figure shows that the expected proportions of catch-at-age follow what is seen in the `r last_data_yr` data except for the large cohort of age 2's. The `r last_data_yr` data was not included in the model

```{r srg-age-comp-forecast-comparison-fig, fig.cap = "(ref:srg-age-comp-forecast-comparison-cap)", fig.height = 5, fig.asp = 0.8, out.height = "6in"}

# load fishery 2025 age props and plot
d <- read_csv(here("beamer-catch-proj/srg/requests/requests-day-1/fishery-age-props-2025.csv"), col_types = cols())
x_lim <- c(1, 15)
x_breaks <- seq(x_lim[1], x_lim[2], 2)
y_lim = c(0, 0.55)

plist <- NULL
plist[[1]] <- ggplot(d,
                     aes(x = age,
                         y = prop)) +
  geom_bar(stat = "identity",
           fill = main_fill,
           alpha = main_alpha) +
  scale_x_continuous(breaks = x_breaks,
                     labels = x_breaks) +
  scale_y_continuous(expand = c(0, 0)) +
  coord_cartesian(xlim = x_lim,
                  ylim = y_lim,
                  expand = TRUE) +
  xlab("") +
  ylab("Prop. 2025 catch") +
  ggtitle("") +
  theme(plot.title = element_text(hjust = 0.5))

plist[[2]] <- plot_fore_age_comps(last_yr_base_model,
                                  y_lim = c(0, 0.7),
                                  by_number_only = TRUE,
                                  show_x_title = FALSE)

plist[[3]] <- plot_fore_age_comps(base_model,
                                  y_lim = c(0, 0.7),
                                  by_number_only = TRUE,
                                  is_catch_proj = TRUE)

plot_grid(plotlist = plist, nrow = 3, align = "v")

```
