# Decision Tables

## Decision Tables

* Decision table format
  - Quantiles from the posterior distribution for *Relative spawning biomass*
    (Table **3**) and *Fishing intensity* (Table **4**)
  - Single row for each catch stream for one year of projections
\item[]
* Catch alternatives
  - **a**: `r ct_levels[[1]][[2]]` (zero catch)
  - **b**--**i**: Constant catches of
    `r str_comma_sep(map_chr(ct_levels[2:9], ~{.x[[2]]}))`.
  - **j**: Constant catch equal to the `r ct_levels[[10]][[2]]`

## Relative Spawning Biomass
```{r decisions-biomass-table, results = "asis"}

table_decision(base_model,
               is_catch_proj_model = TRUE,
               num_yrs_to_show = 1,
               type = "biomass",
               #rows_to_show = c("a", "b", "e", "j"),
               font_size = 6,
               header_font_size = 7) |> 
    row_spec(5,
           bold = table_highlight_bold,
           background = table_highlight_color)
```

## Probability table definitions

Probabilities associated with biomass and fishing-based metrics for different
catch streams (see assessment document): Table **5** and Figure **5**.

* Project with the catch in `r assess_yr` to estimate *B*\textsubscript{`r assess_yr + 1`}

* P(*B*\textsubscript{`r assess_yr + 1`} < *B*\textsubscript{`r assess_yr`}): Probability that biomass in `r assess_yr + 1` is less than the specified biomasses *B*\textsubscript{`r assess_yr`}, `r b_40`, `r b_25`, and `r b_10`

* P(relative FI > 100% target): Probability that relative fishing intensity
  in `r assess_yr` will be greater than the target fishing intensity

* Probabilities are calculated as proportions of the MCMC samples meeting
  the criteria, e.g., 50% probability of being under `r b_40` means that
  4,000 of the 8,000 MCMC samples were under `r b_40`

## Probabilities based on `r end_yr` catch

```{r main-risk-forecast-year-1-table, results = "asis"}

table_risk(base_model,
           forecast_yrs,
           index = 1,
           is_catch_proj = TRUE,
           type = "probability",
           font_size = 8,
           header_font_size = 9) |> 
    row_spec(4,
           bold = table_highlight_bold,
           background = table_highlight_color)
```

## Probabilities based on `r end_yr` catch
```{r forecast-risk-comparison-plot-year-1, fig.height = 3.5, out.height = "80%"}

plot_fore_compare(base_model,
                  forecast_yrs = forecast_yrs,
                  fore_yr = forecast_yrs[1],
                  leg_pos = c(0.25, 0.6),
                  leg_font_size = 9) +
                  #remove_x_val = c(270)) +
  # Following make the legend smaller and legend items closer together
  theme(legend.key.size = unit(0.25, "cm"),
        legend.spacing.y = unit(0.01, "cm"),
        legend.box.background = element_rect(colour = "black")) +
  guides(color = guide_legend(byrow = TRUE))
```

